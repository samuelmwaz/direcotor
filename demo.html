<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>CNS Director | Command Center</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=DM+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root{--bg:#080e1a;--surface:#0f1c2e;--card:#132035;--card2:#0c1929;--border:rgba(255,255,255,0.07);--text:#e8f0fe;--muted:#6a8aaa;--urgent:#ff3b5c;--warning:#ffb800;--safe:#00e5a0;--accent:#2979ff;--accent2:#00b4ff;}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent;margin:0;padding:0;}
body{background:var(--bg);color:var(--text);font-family:'DM Sans',sans-serif;min-height:100dvh;overscroll-behavior:none;-webkit-font-smoothing:antialiased;}
body::before{content:'';position:fixed;inset:0;background:radial-gradient(ellipse 70% 50% at 20% 10%,rgba(41,121,255,.10) 0%,transparent 70%),radial-gradient(ellipse 50% 40% at 80% 80%,rgba(0,180,255,.07) 0%,transparent 70%);pointer-events:none;z-index:0;}
.hdr{position:fixed;top:0;left:0;right:0;height:60px;background:rgba(8,14,26,.97);backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;padding:0 16px;z-index:100;}
.hbrand{display:flex;flex-direction:column;}
.hbrand span:first-child{font-family:'Space Mono',monospace;font-size:.7rem;color:var(--accent2);letter-spacing:.1em;}
.hbrand span:last-child{font-size:.97rem;font-weight:700;}
#clock{font-family:'Space Mono',monospace;font-size:.7rem;color:var(--safe);background:rgba(0,229,160,.08);border:1px solid rgba(0,229,160,.2);padding:6px 10px;border-radius:8px;white-space:nowrap;}
.scroll-area{padding:76px 14px 110px;position:relative;z-index:1;}
.st{font-size:.6rem;font-weight:700;letter-spacing:.16em;text-transform:uppercase;color:var(--muted);margin:20px 0 10px 2px;}
.shr{display:flex;align-items:center;justify-content:space-between;margin:20px 2px 10px;}
.shr .st{margin:0;}
.add-btn{background:rgba(41,121,255,.13);border:1px solid rgba(41,121,255,.3);color:var(--accent2);border-radius:8px;padding:8px 13px;font-size:.74rem;font-weight:700;cursor:pointer;font-family:inherit;}
.card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:15px;margin-bottom:12px;position:relative;overflow:hidden;}
.card::before{content:'';position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,rgba(255,255,255,.10),transparent);}
.kg{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:12px;}
.kpi{background:var(--card2);border:1px solid var(--border);border-radius:12px;padding:13px 12px;display:flex;flex-direction:column;gap:3px;}
.kl{font-size:.63rem;color:var(--muted);font-weight:500;}
.kv{font-family:'Space Mono',monospace;font-size:1.38rem;font-weight:700;line-height:1.1;}
.ks{font-size:.63rem;color:var(--muted);}
.green{color:var(--safe);}.yellow{color:var(--warning);}.red{color:var(--urgent);}
.dot{width:10px;height:10px;border-radius:50%;flex-shrink:0;}
.dg{background:var(--safe);box-shadow:0 0 8px var(--safe);}
.dy{background:var(--warning);box-shadow:0 0 8px var(--warning);}
.dr{background:var(--urgent);box-shadow:0 0 8px var(--urgent);animation:blink 1.2s infinite;}
@keyframes blink{50%{opacity:.25;}}
.badge{font-size:.57rem;font-weight:700;letter-spacing:.06em;padding:3px 7px;border-radius:20px;text-transform:uppercase;flex-shrink:0;}
.bg{background:rgba(0,229,160,.12);color:var(--safe);border:1px solid rgba(0,229,160,.25);}
.by{background:rgba(255,184,0,.12);color:var(--warning);border:1px solid rgba(255,184,0,.3);}
.br{background:rgba(255,59,92,.12);color:var(--urgent);border:1px solid rgba(255,59,92,.3);}
.ri{background:var(--card2);border:1px solid var(--border);border-radius:12px;padding:13px;margin-bottom:8px;}
.ri:last-child{margin-bottom:0;}
.btn-row{display:grid;grid-template-columns:1fr 1fr 1fr;gap:7px;margin-top:10px;}
.b-done,.b-edit,.b-del{border-radius:9px;padding:11px 0;font-size:.79rem;font-weight:700;cursor:pointer;font-family:inherit;width:100%;}
.b-done{background:rgba(0,229,160,.10);border:1px solid rgba(0,229,160,.35);color:var(--safe);}
.b-edit{background:rgba(41,121,255,.10);border:1px solid rgba(41,121,255,.35);color:var(--accent2);}
.b-del{background:rgba(255,59,92,.08);border:1px solid rgba(255,59,92,.35);color:var(--urgent);}
.b-clr{background:rgba(255,59,92,.07);border:1px solid rgba(255,59,92,.28);color:var(--urgent);border-radius:8px;padding:7px 11px;font-size:.72rem;font-weight:700;cursor:pointer;font-family:inherit;}
.bpri{width:100%;background:var(--accent);color:white;border:none;border-radius:10px;padding:14px;font-size:.92rem;font-weight:700;cursor:pointer;font-family:inherit;margin-top:2px;}
.bpri:active{opacity:.85;}
.pw{margin-bottom:10px;}.pw:last-child{margin-bottom:0;}
.ph{display:flex;justify-content:space-between;font-size:.82rem;margin-bottom:5px;}
.pb{background:rgba(255,255,255,.07);height:7px;border-radius:10px;overflow:hidden;}
.pf{height:100%;border-radius:10px;}
.mi{background:var(--card2);border:1px solid var(--border);border-radius:12px;padding:13px;margin-bottom:8px;}
.mi:last-child{margin-bottom:0;}
.mi-top{display:flex;align-items:center;gap:12px;margin-bottom:10px;}
.md{background:rgba(41,121,255,.14);border:1px solid rgba(41,121,255,.25);border-radius:10px;padding:8px 9px;text-align:center;min-width:42px;flex-shrink:0;}
.mdd{font-family:'Space Mono',monospace;font-size:1.1rem;font-weight:700;color:var(--accent2);line-height:1;}
.mmm{font-size:.57rem;text-transform:uppercase;color:var(--muted);letter-spacing:.08em;}
.mi-info{flex:1;min-width:0;}
.mi-info strong{display:block;font-size:.87rem;font-weight:600;}
.mi-info p{font-size:.7rem;color:var(--muted);margin-top:2px;}
.cdwn{font-size:.68rem;font-weight:600;margin-top:3px;}
.rb{background:rgba(41,121,255,.13);border:1px solid rgba(41,121,255,.3);color:var(--accent2);border-radius:8px;padding:8px 10px;font-size:.68rem;font-weight:700;cursor:pointer;white-space:nowrap;flex-shrink:0;font-family:inherit;}
.rb.armed{background:rgba(0,229,160,.12);border-color:rgba(0,229,160,.3);color:var(--safe);}
.ae{display:flex;align-items:flex-start;gap:10px;padding:11px 0;border-bottom:1px solid var(--border);}
.ae:last-child{border-bottom:none;padding-bottom:0;}
.ldot{width:7px;height:7px;border-radius:50%;margin-top:5px;flex-shrink:0;}
.ltxt{font-size:.79rem;color:var(--muted);line-height:1.4;}
.ltxt strong{color:var(--text);}
.ltime{font-family:'Space Mono',monospace;font-size:.62rem;color:var(--muted);margin-top:2px;}
.fi2{background:var(--card2);border:1px solid var(--border);border-radius:11px;padding:12px 13px;margin-bottom:8px;display:flex;align-items:flex-start;gap:11px;}
.fi2:last-child{margin-bottom:0;}
.fi2-icon{font-size:1.1rem;flex-shrink:0;margin-top:1px;}
.fi2-body{flex:1;min-width:0;}
.fi2-title{font-size:.84rem;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.fi2-sub{font-size:.69rem;color:var(--muted);margin-top:1px;line-height:1.4;}
.qa{display:grid;grid-template-columns:1fr 1fr;gap:8px;}
.qb{background:var(--card2);border:1px solid var(--border);border-radius:12px;padding:15px 12px;color:var(--text);cursor:pointer;text-align:left;display:flex;flex-direction:column;gap:5px;font-family:inherit;}
.qb:active{border-color:rgba(255,255,255,.18);}
.qi{font-size:1.3rem;}.ql{font-size:.81rem;font-weight:600;}.qs{font-size:.65rem;color:var(--muted);}
.fi,.fs,.fta{width:100%;background:var(--card2);border:1px solid var(--border);border-radius:10px;color:var(--text);font-family:'DM Sans',sans-serif;font-size:.88rem;padding:13px;outline:none;display:block;margin-bottom:10px;}
.fi:focus,.fs:focus,.fta:focus{border-color:rgba(41,121,255,.5);}
.fta{resize:none;height:85px;}
.fs option{background:#132035;}
.bnav{position:fixed;bottom:0;left:0;right:0;background:rgba(8,14,26,.98);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border-top:2px solid rgba(41,121,255,.3);display:flex;align-items:center;justify-content:space-around;padding:10px 6px;padding-bottom:calc(12px + env(safe-area-inset-bottom,8px));z-index:100;box-shadow:0 -6px 24px rgba(0,0,0,.5);}
.nv{display:flex;flex-direction:column;align-items:center;gap:4px;padding:8px 14px;border-radius:12px;cursor:pointer;flex:1;min-height:52px;justify-content:center;transition:background .15s;}
.nv.active{background:rgba(41,121,255,.16);border:1px solid rgba(41,121,255,.25);}
.ni{font-size:1.4rem;line-height:1;}
.nl{font-size:.59rem;font-weight:700;letter-spacing:.05em;color:var(--muted);text-transform:uppercase;}
.nv.active .nl{color:var(--accent2);}
.page{display:none;}.page.active{display:block;}
.mo{position:fixed;inset:0;background:rgba(0,0,0,.74);backdrop-filter:blur(5px);z-index:300;display:none;align-items:flex-end;justify-content:center;}
.mo.show{display:flex;}
.ms{background:var(--surface);border:1px solid var(--border);border-radius:22px 22px 0 0;padding:22px 18px;padding-bottom:calc(22px + env(safe-area-inset-bottom,10px));width:100%;max-width:500px;animation:sup .27s cubic-bezier(.4,0,.2,1);max-height:93dvh;overflow-y:auto;}
@keyframes sup{from{transform:translateY(100%);}to{transform:translateY(0);}}
.mh{width:38px;height:4px;background:var(--border);border-radius:2px;margin:0 auto 18px;}
.mt{font-size:1.05rem;font-weight:700;margin-bottom:16px;}
.mr{display:flex;gap:8px;margin-top:4px;}
.mbsec{flex:1;padding:13px;border-radius:10px;font-size:.88rem;font-weight:700;cursor:pointer;border:1px solid var(--border);background:var(--card2);color:var(--muted);font-family:inherit;}
.mbpri{flex:1;padding:13px;border-radius:10px;font-size:.88rem;font-weight:700;cursor:pointer;border:none;background:var(--accent);color:white;font-family:inherit;}
.mbdgr{flex:1;padding:13px;border-radius:10px;font-size:.88rem;font-weight:700;cursor:pointer;border:none;background:var(--urgent);color:white;font-family:inherit;}
#toast{position:fixed;bottom:calc(108px + env(safe-area-inset-bottom,8px));left:50%;transform:translateX(-50%) translateY(16px);background:var(--safe);color:#000;font-weight:700;font-size:.8rem;padding:10px 22px;border-radius:50px;opacity:0;transition:opacity .28s,transform .28s;z-index:400;white-space:nowrap;pointer-events:none;}
#toast.show{opacity:1;transform:translateX(-50%) translateY(0);}
.empty{text-align:center;color:var(--muted);font-size:.84rem;padding:22px 0;}
.empty span{font-size:2rem;display:block;margin-bottom:8px;}
</style>
</head>
<body>

<div class="hdr">
  <div class="hbrand"><span>CNS PORTAL</span><span>Director Command</span></div>
  <div id="clock">--:--:-- CAT</div>
</div>

<div class="scroll-area">

<!-- â•â•â• DASHBOARD â•â•â• -->
<div class="page active" id="page-home">
  <div class="st">Overview Â· Live</div>
  <div class="kg">
    <div class="kpi"><span class="kl">Open Actions</span><span class="kv yellow" id="k-actions">0</span><span class="ks">Pending items</span></div>
    <div class="kpi"><span class="kl">Compliance</span><span class="kv green" id="k-comp">OK</span><span class="ks" id="k-comp-sub">2 of 2 clear</span></div>
    <div class="kpi"><span class="kl">Meetings</span><span class="kv green" id="k-meetings">0</span><span class="ks">Scheduled</span></div>
    <div class="kpi"><span class="kl">Audit Entries</span><span class="kv green" id="k-audit">0</span><span class="ks">All time</span></div>
  </div>

  <div class="st">Compliance Radar</div>
  <div class="card" style="padding:13px;">
    <div class="ri" style="margin-bottom:8px;">
      <div style="display:flex;align-items:center;gap:11px;">
        <div class="dot" id="zra-dot"></div>
        <div style="flex:1;min-width:0;"><strong style="display:block;font-size:.87rem;font-weight:600;">ZRA Smart Invoice</strong><p style="font-size:.7rem;color:var(--muted);" id="zra-desc">Calculatingâ€¦</p></div>
        <span class="badge" id="zra-badge">â€”</span>
      </div>
    </div>
    <div class="ri">
      <div style="display:flex;align-items:center;gap:11px;">
        <div class="dot dg"></div>
        <div style="flex:1;min-width:0;"><strong style="display:block;font-size:.87rem;font-weight:600;">PACRA Annual Return</strong><p style="font-size:.7rem;color:var(--muted);">Compliant Â· Next: Mar 2026</p></div>
        <span class="badge bg">Clear</span>
      </div>
    </div>
  </div>

  <div class="shr">
    <span class="st">Recent Actions</span>
    <button class="add-btn" onclick="go('actions')">+ Add Action</button>
  </div>
  <div class="card" style="padding:13px;" id="dash-actions">
    <div class="empty"><span>âœ…</span>No actions yet.<br>Tap + Add Action to begin.</div>
  </div>

  <div class="shr">
    <span class="st">Upcoming Meetings</span>
    <button class="add-btn" onclick="go('meetings')">+ Add Meeting</button>
  </div>
  <div class="card" style="padding:13px;" id="dash-meetings">
    <div class="empty"><span>ğŸ“…</span>No meetings scheduled.<br>Tap + Add Meeting to begin.</div>
  </div>

  <div class="shr">
    <span class="st">Recent Audit Activity</span>
    <button class="add-btn" onclick="go('audit')">+ Log Entry</button>
  </div>
  <div class="card" style="padding:13px;" id="dash-audit">
    <div class="empty"><span>ğŸ”</span>No audit entries yet.</div>
  </div>

  <div class="st">Quick Actions</div>
  <div class="card" style="padding:13px;">
    <div class="qa">
      <button class="qb" onclick="openMo('resolution')"><span class="qi">ğŸ“</span><span class="ql">Log Resolution</span><span class="qs">Record a decision</span></button>
      <button class="qb" onclick="go('actions')"><span class="qi">âœ…</span><span class="ql">Action Items</span><span class="qs" id="qa-sub-a">0 pending</span></button>
      <button class="qb" onclick="go('meetings')"><span class="qi">ğŸ“…</span><span class="ql">Meetings</span><span class="qs" id="qa-sub-m">0 scheduled</span></button>
      <button class="qb" onclick="go('audit')"><span class="qi">ğŸ”</span><span class="ql">Audit Trail</span><span class="qs" id="qa-sub-au">0 entries</span></button>
    </div>
  </div>

  <div class="st">Fiber Infrastructure</div>
  <div class="card">
    <div class="pw"><div class="ph"><span>Lusaka Metro Phase 3</span><span class="green" style="font-family:'Space Mono',monospace;font-size:.8rem;">78%</span></div><div class="pb"><div class="pf" style="width:78%;background:var(--safe);"></div></div></div>
    <div class="pw"><div class="ph"><span>Copper Belt Phase 1</span><span class="yellow" style="font-family:'Space Mono',monospace;font-size:.8rem;">44%</span></div><div class="pb"><div class="pf" style="width:44%;background:var(--warning);"></div></div></div>
    <div class="pw"><div class="ph"><span>Eastern Province</span><span class="red" style="font-family:'Space Mono',monospace;font-size:.8rem;">12%</span></div><div class="pb"><div class="pf" style="width:12%;background:var(--urgent);"></div></div></div>
  </div>
</div>

<!-- â•â•â• ACTIONS â•â•â• -->
<div class="page" id="page-actions">
  <div class="st">Action Items Â· Accountability</div>
  <div class="card" style="padding:13px;" id="actions-list">
    <div class="empty"><span>âœ…</span>No actions yet. Add one below.</div>
  </div>
  <div class="st">Add New Action</div>
  <div class="card">
    <input id="na-text" class="fi" type="text" placeholder="Describe the action itemâ€¦">
    <select id="na-owner" class="fs">
      <option value="">Assign to directorâ€¦</option>
      <option>Dir. Banda</option><option>Dir. Mwale</option><option>Dir. Phiri</option><option>Dir. Tembo</option><option>Yourself</option>
    </select>
    <input id="na-due" class="fi" type="date">
    <select id="na-prio" class="fs">
      <option value="Normal">Priority: Normal</option>
      <option value="High">Priority: High</option>
      <option value="Critical">Priority: Critical</option>
    </select>
    <button class="bpri" onclick="addAction()">â• Add Action Item</button>
  </div>
</div>

<!-- â•â•â• MEETINGS â•â•â• -->
<div class="page" id="page-meetings">
  <div class="st">Scheduled Meetings</div>
  <div class="card" style="padding:13px;" id="meetings-list">
    <div class="empty"><span>ğŸ“…</span>No meetings yet. Add one below.</div>
  </div>
  <div class="st">Add New Meeting</div>
  <div class="card">
    <input id="nm-title" class="fi" type="text" placeholder="Meeting titleâ€¦">
    <input id="nm-date" class="fi" type="date">
    <input id="nm-time" class="fi" type="time">
    <input id="nm-location" class="fi" type="text" placeholder="Location or video linkâ€¦">
    <select id="nm-owner" class="fs">
      <option value="">Chaired byâ€¦</option>
      <option>Dir. Banda</option><option>Dir. Mwale</option><option>Dir. Phiri</option><option>Dir. Tembo</option><option>Yourself</option>
    </select>
    <textarea id="nm-notes" class="fta" placeholder="Agenda notes / prep topicsâ€¦"></textarea>
    <button class="bpri" onclick="addMeeting()">ğŸ“… Add Meeting</button>
  </div>
</div>

<!-- â•â•â• AUDIT â•â•â• -->
<div class="page" id="page-audit">
  <div class="shr" style="margin-top:20px;">
    <span class="st" style="margin:0;">Audit Trail Â· All Activity</span>
    <button class="add-btn" onclick="openMo('manual-audit')">+ Add Entry</button>
  </div>
  <div class="card" style="padding:13px;" id="audit-list">
    <div class="empty"><span>ğŸ”</span>No audit entries yet.</div>
  </div>
</div>

</div><!-- /scroll-area -->

<nav class="bnav">
  <div class="nv active" id="nav-home"     onclick="go('home')">    <span class="ni">ğŸ </span><span class="nl">Dashboard</span></div>
  <div class="nv"        id="nav-actions"  onclick="go('actions')"> <span class="ni">âœ…</span><span class="nl">Actions</span></div>
  <div class="nv"        id="nav-meetings" onclick="go('meetings')"><span class="ni">ğŸ“…</span><span class="nl">Meetings</span></div>
  <div class="nv"        id="nav-audit"    onclick="go('audit')">   <span class="ni">ğŸ”</span><span class="nl">Audit</span></div>
</nav>

<!-- â•â•â• MODALS â•â•â• -->

<!-- EDIT ACTION -->
<div class="mo" id="mo-edit-action">
  <div class="ms">
    <div class="mh"></div><div class="mt">âœï¸ Edit Action</div>
    <input type="hidden" id="ea-id">
    <input id="ea-text" class="fi" type="text" placeholder="Action descriptionâ€¦">
    <select id="ea-owner" class="fs">
      <option value="">Assign to directorâ€¦</option>
      <option>Dir. Banda</option><option>Dir. Mwale</option><option>Dir. Phiri</option><option>Dir. Tembo</option><option>Yourself</option>
    </select>
    <input id="ea-due" class="fi" type="date">
    <select id="ea-prio" class="fs" style="margin-bottom:14px;">
      <option value="Normal">Priority: Normal</option><option value="High">Priority: High</option><option value="Critical">Priority: Critical</option>
    </select>
    <div class="mr"><button class="mbsec" onclick="closeMo()">Cancel</button><button class="mbpri" onclick="saveEditAction()">ğŸ’¾ Save Changes</button></div>
  </div>
</div>

<!-- DELETE ACTION -->
<div class="mo" id="mo-del-action">
  <div class="ms">
    <div class="mh"></div><div class="mt" style="color:var(--urgent);">ğŸ—‘ Delete Action?</div>
    <input type="hidden" id="da-id">
    <p id="da-prev" style="color:var(--muted);font-size:.87rem;margin-bottom:20px;line-height:1.5;"></p>
    <div class="mr"><button class="mbsec" onclick="closeMo()">Keep It</button><button class="mbdgr" onclick="confirmDelAction()">Yes, Delete</button></div>
  </div>
</div>

<!-- EDIT MEETING -->
<div class="mo" id="mo-edit-meeting">
  <div class="ms">
    <div class="mh"></div><div class="mt">âœï¸ Edit Meeting</div>
    <input type="hidden" id="em-id">
    <input id="em-title" class="fi" type="text" placeholder="Meeting titleâ€¦">
    <input id="em-date" class="fi" type="date">
    <input id="em-time" class="fi" type="time">
    <input id="em-location" class="fi" type="text" placeholder="Location or linkâ€¦">
    <select id="em-owner" class="fs">
      <option value="">Chaired byâ€¦</option>
      <option>Dir. Banda</option><option>Dir. Mwale</option><option>Dir. Phiri</option><option>Dir. Tembo</option><option>Yourself</option>
    </select>
    <textarea id="em-notes" class="fta" placeholder="Agenda notesâ€¦"></textarea>
    <div class="mr"><button class="mbsec" onclick="closeMo()">Cancel</button><button class="mbpri" onclick="saveEditMeeting()">ğŸ’¾ Save Changes</button></div>
  </div>
</div>

<!-- DELETE MEETING -->
<div class="mo" id="mo-del-meeting">
  <div class="ms">
    <div class="mh"></div><div class="mt" style="color:var(--urgent);">ğŸ—‘ Delete Meeting?</div>
    <input type="hidden" id="dm-id">
    <p id="dm-prev" style="color:var(--muted);font-size:.87rem;margin-bottom:20px;line-height:1.5;"></p>
    <div class="mr"><button class="mbsec" onclick="closeMo()">Keep It</button><button class="mbdgr" onclick="confirmDelMeeting()">Yes, Delete</button></div>
  </div>
</div>

<!-- LOG RESOLUTION -->
<div class="mo" id="mo-resolution">
  <div class="ms">
    <div class="mh"></div><div class="mt">ğŸ“ Log a Resolution</div>
    <textarea id="res-text" class="fta" placeholder="Describe the resolution or decision madeâ€¦"></textarea>
    <select id="res-owner" class="fs" style="margin-bottom:14px;">
      <option value="">Responsible directorâ€¦</option>
      <option>Dir. Banda</option><option>Dir. Mwale</option><option>Dir. Phiri</option><option>Dir. Tembo</option><option>Yourself</option>
    </select>
    <div class="mr"><button class="mbsec" onclick="closeMo()">Cancel</button><button class="mbpri" onclick="saveResolution()">ğŸ’¾ Save Resolution</button></div>
  </div>
</div>

<!-- MANUAL AUDIT -->
<div class="mo" id="mo-manual-audit">
  <div class="ms">
    <div class="mh"></div><div class="mt">ğŸ” Add Audit Entry</div>
    <input id="ma-title" class="fi" type="text" placeholder="Entry subject / titleâ€¦">
    <textarea id="ma-detail" class="fta" placeholder="Details of what was done, decided or observedâ€¦"></textarea>
    <select id="ma-type" class="fs">
      <option value="info">Type: Information</option>
      <option value="decision">Type: Decision</option>
      <option value="warning">Type: Warning / Issue</option>
      <option value="compliance">Type: Compliance</option>
    </select>
    <select id="ma-owner" class="fs" style="margin-bottom:14px;">
      <option value="">Logged byâ€¦</option>
      <option>Dir. Banda</option><option>Dir. Mwale</option><option>Dir. Phiri</option><option>Dir. Tembo</option><option>Yourself</option>
    </select>
    <div class="mr"><button class="mbsec" onclick="closeMo()">Cancel</button><button class="mbpri" onclick="saveManualAudit()">ğŸ“‹ Save Entry</button></div>
  </div>
</div>

<div id="toast">Done</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let actions  = [];
let meetings = [];
let auditLog = [];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CLOCK
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(function tick(){
  document.getElementById('clock').textContent =
    new Date().toLocaleString('en-GB',{timeZone:'Africa/Lusaka',hour:'2-digit',minute:'2-digit',second:'2-digit'})+' CAT';
  setTimeout(tick,1000);
})();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// COMPLIANCE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function compliance(){
  var day=new Date().getDate();
  var dot=document.getElementById('zra-dot');
  var desc=document.getElementById('zra-desc');
  var bdg=document.getElementById('zra-badge');
  if(day<=7){
    dot.className='dot dg'; desc.textContent='Next filing due in '+(14-day)+' days.';
    bdg.textContent='OK'; bdg.className='badge bg';
  } else if(day<=14){
    dot.className='dot dy'; desc.textContent='Filing window open â€” verify now.';
    bdg.textContent='Soon'; bdg.className='badge by';
    var kc=document.getElementById('k-comp'); kc.textContent='!'; kc.className='kv yellow';
    document.getElementById('k-comp-sub').textContent='1 needs attention';
  } else {
    dot.className='dot dr'; desc.textContent='URGENT: Verify monthly return!';
    bdg.textContent='Urgent'; bdg.className='badge br';
    var kc2=document.getElementById('k-comp'); kc2.textContent='!'; kc2.className='kv red';
    document.getElementById('k-comp-sub').textContent='1 overdue';
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NAV
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function go(name){
  document.querySelectorAll('.page').forEach(function(p){p.classList.remove('active');});
  document.querySelectorAll('.nv').forEach(function(n){n.classList.remove('active');});
  document.getElementById('page-'+name).classList.add('active');
  document.getElementById('nav-'+name).classList.add('active');
  window.scrollTo(0,0);
  if(name==='home')     renderDash();
  if(name==='actions')  renderActions();
  if(name==='meetings') renderMeetings();
  if(name==='audit')    renderAudit();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AUDIT LOG HELPER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var COLORS={action:'var(--safe)',meeting:'var(--accent2)',resolution:'var(--warning)',system:'var(--muted)',delete:'var(--urgent)',manual:'var(--accent2)'};
function log(text,type){
  var now=new Date();
  auditLog.unshift({
    id: ''+Date.now()+Math.random(),
    text:text, type:type||'system',
    color: COLORS[type]||'var(--muted)',
    time: now.toLocaleString('en-GB',{timeZone:'Africa/Lusaka',hour:'2-digit',minute:'2-digit'})+' CAT',
    date: now.toLocaleDateString('en-GB',{day:'2-digit',month:'short',year:'numeric'})
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TOAST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toast(msg){
  var t=document.getElementById('toast'); t.textContent=msg; t.classList.add('show');
  setTimeout(function(){t.classList.remove('show');},2800);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODAL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openMo(id){ document.getElementById('mo-'+id).classList.add('show'); }
function closeMo(){ document.querySelectorAll('.mo').forEach(function(m){m.classList.remove('show');}); }
document.querySelectorAll('.mo').forEach(function(o){
  o.addEventListener('click',function(e){if(e.target===o)closeMo();});
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DASHBOARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderDash(){
  var pending=actions.filter(function(a){return !a.done;});

  // KPIs
  var ka=document.getElementById('k-actions');
  ka.textContent=pending.length; ka.className='kv '+(pending.length>0?'yellow':'green');
  document.getElementById('k-meetings').textContent=meetings.length;
  document.getElementById('k-audit').textContent=auditLog.length;
  document.getElementById('qa-sub-a').textContent=pending.length+' pending';
  document.getElementById('qa-sub-m').textContent=meetings.length+' scheduled';
  document.getElementById('qa-sub-au').textContent=auditLog.length+' entries';

  // Recent Actions
  var da=document.getElementById('dash-actions');
  if(!pending.length){
    da.innerHTML='<div class="empty"><span>âœ…</span>No pending actions yet.<br>Tap + Add Action above to create one.</div>';
  } else {
    var h=pending.slice(0,3).map(function(a){
      var od=new Date(a.due)<new Date();
      var pc=a.priority==='Critical'?'var(--urgent)':a.priority==='High'?'var(--warning)':'var(--muted)';
      return '<div class="fi2">'
        +'<div class="fi2-icon">'+(od?'ğŸ”´':'ğŸŸ¡')+'</div>'
        +'<div class="fi2-body">'
        +'<div class="fi2-title">'+a.text+'</div>'
        +'<div class="fi2-sub">'+a.owner+' Â· Due '+a.due+' Â· <span style="color:'+pc+';font-weight:600;">'+a.priority+'</span>'+(od?' Â· <span style="color:var(--urgent);font-weight:700;">OVERDUE</span>':'')+'</div>'
        +'</div>'
        +'<button class="b-done" style="width:auto;padding:8px 12px;font-size:.72rem;flex-shrink:0;" onclick="markDoneFromDash('+a.id+')">âœ“ Done</button>'
        +'</div>';
    }).join('');
    if(pending.length>3) h+='<div style="text-align:center;padding-top:10px;"><button onclick="go(\'actions\')" style="background:none;border:none;color:var(--accent2);font-size:.78rem;font-weight:700;cursor:pointer;">View all '+pending.length+' actions â†’</button></div>';
    da.innerHTML=h;
  }

  // Upcoming Meetings
  var dm=document.getElementById('dash-meetings');
  var today=new Date(); today.setHours(0,0,0,0);
  var upcoming=meetings.filter(function(m){return new Date(m.date)>=today;}).sort(function(a,b){return new Date(a.date)-new Date(b.date);});
  if(!upcoming.length){
    dm.innerHTML='<div class="empty"><span>ğŸ“…</span>No upcoming meetings.<br>Tap + Add Meeting above to schedule one.</div>';
  } else {
    dm.innerHTML=upcoming.slice(0,3).map(function(m){
      var d=new Date(m.date);
      var da2=Math.ceil((d-today)/86400000);
      return '<div class="fi2">'
        +'<div class="md" style="min-width:38px;padding:6px 8px;">'
        +'<div class="mdd" style="font-size:1rem;">'+String(d.getDate()).padStart(2,'0')+'</div>'
        +'<div class="mmm">'+d.toLocaleString('en-GB',{month:'short'}).toUpperCase()+'</div></div>'
        +'<div class="fi2-body">'
        +'<div class="fi2-title">'+m.title+'</div>'
        +'<div class="fi2-sub">'+m.time+' Â· '+(m.location||'TBD')+(m.owner?' Â· '+m.owner:'')+'</div>'
        +'<div style="font-size:.68rem;color:var(--warning);font-weight:600;margin-top:2px;">'+(da2<=0?'TODAY!':da2+'d away')+'</div>'
        +'</div></div>';
    }).join('');
  }

  // Recent Audit
  var dau=document.getElementById('dash-audit');
  if(!auditLog.length){
    dau.innerHTML='<div class="empty"><span>ğŸ”</span>No audit entries yet.</div>';
  } else {
    dau.innerHTML=auditLog.slice(0,4).map(function(e){
      return '<div class="fi2" style="align-items:center;">'
        +'<div class="ldot" style="background:'+e.color+';width:8px;height:8px;border-radius:50%;flex-shrink:0;margin-top:0;"></div>'
        +'<div class="fi2-body"><div class="ltxt">'+e.text+'</div><div class="ltime">'+e.time+' Â· '+e.date+'</div></div>'
        +'</div>';
    }).join('');
  }
}

// Mark done directly from dashboard
function markDoneFromDash(id){
  var a=actions.find(function(x){return x.id===id;});
  if(!a) return;
  a.done=true;
  log('<strong>'+a.owner+'</strong> completed: "'+a.text.substring(0,50)+(a.text.length>50?'â€¦':'')+'"','action');
  renderDash();
  toast('âœ“ Action marked complete');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ACTIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderActions(){
  var el=document.getElementById('actions-list');
  var pending=actions.filter(function(a){return !a.done;});
  var done=actions.filter(function(a){return a.done;});
  if(!actions.length){el.innerHTML='<div class="empty"><span>âœ…</span>No actions yet. Add one below.</div>';return;}
  var h='';
  if(pending.length){
    h+='<div style="font-size:.6rem;color:var(--muted);letter-spacing:.13em;text-transform:uppercase;margin-bottom:10px;">Pending ('+pending.length+')</div>';
    pending.forEach(function(a){
      var od=new Date(a.due)<new Date();
      var pc=a.priority==='Critical'?'var(--urgent)':a.priority==='High'?'var(--warning)':'var(--muted)';
      h+='<div class="ri">'
        +'<div style="display:flex;align-items:flex-start;gap:11px;margin-bottom:10px;">'
        +'<div class="dot '+(od?'dr':'dy')+'" style="margin-top:3px;"></div>'
        +'<div style="flex:1;min-width:0;">'
        +'<strong style="display:block;font-size:.87rem;font-weight:600;margin-bottom:2px;">'+a.text+'</strong>'
        +'<p style="font-size:.7rem;color:var(--muted);">'+a.owner+' Â· Due '+a.due+' Â· <span style="color:'+pc+';font-weight:600;">'+a.priority+'</span>'+(od?' Â· <span style="color:var(--urgent);font-weight:700;">OVERDUE</span>':'')+'</p>'
        +'</div></div>'
        +'<div class="btn-row">'
        +'<button class="b-done" onclick="markDone('+a.id+')">âœ“ Done</button>'
        +'<button class="b-edit" onclick="openEditAction('+a.id+')">âœ Edit</button>'
        +'<button class="b-del" onclick="openDelAction('+a.id+')">ğŸ—‘ Del</button>'
        +'</div></div>';
    });
  }
  if(done.length){
    h+='<div style="font-size:.6rem;color:var(--muted);letter-spacing:.13em;text-transform:uppercase;margin:14px 0 10px;">Completed ('+done.length+')</div>';
    done.forEach(function(a){
      h+='<div class="ri" style="opacity:.42;">'
        +'<div style="display:flex;align-items:center;gap:11px;">'
        +'<div class="dot dg"></div>'
        +'<div style="flex:1;min-width:0;">'
        +'<strong style="text-decoration:line-through;color:var(--muted);font-size:.85rem;">'+a.text+'</strong>'
        +'<p style="font-size:.69rem;color:var(--muted);">'+a.owner+'</p>'
        +'</div>'
        +'<button class="b-clr" onclick="clearDone('+a.id+')">Clear</button>'
        +'</div></div>';
    });
  }
  el.innerHTML=h;
}

function addAction(){
  var text=document.getElementById('na-text').value.trim();
  var owner=document.getElementById('na-owner').value;
  var due=document.getElementById('na-due').value;
  var prio=document.getElementById('na-prio').value||'Normal';
  if(!text||!owner||!due){toast('âš  Fill in all fields');return;}
  actions.push({id:Date.now(),text:text,owner:owner,due:due,priority:prio,done:false});
  log('<strong>Action added</strong> for '+owner+': "'+text.substring(0,50)+(text.length>50?'â€¦':'')+'"','action');
  document.getElementById('na-text').value='';
  document.getElementById('na-owner').value='';
  document.getElementById('na-due').value='';
  document.getElementById('na-prio').value='Normal';
  renderActions(); renderDash(); toast('âœ“ Action added â€” now visible on Dashboard');
}

function markDone(id){
  var a=actions.find(function(x){return x.id===id;});
  if(!a) return;
  a.done=true;
  log('<strong>'+a.owner+'</strong> completed: "'+a.text.substring(0,50)+(a.text.length>50?'â€¦':'')+'"','action');
  renderActions(); renderDash(); toast('âœ“ Marked complete â€” Dashboard updated');
}

function clearDone(id){
  var a=actions.find(function(x){return x.id===id;});
  if(!a) return;
  log('<strong>Cleared</strong> completed action: "'+a.text.substring(0,40)+'"','delete');
  actions=actions.filter(function(x){return x.id!==id;});
  renderActions(); renderDash(); toast('ğŸ—‘ Cleared');
}

function openEditAction(id){
  var a=actions.find(function(x){return x.id===id;});
  if(!a) return;
  document.getElementById('ea-id').value=id;
  document.getElementById('ea-text').value=a.text;
  document.getElementById('ea-due').value=a.due;
  document.getElementById('ea-prio').value=a.priority||'Normal';
  var s=document.getElementById('ea-owner');
  for(var i=0;i<s.options.length;i++) if(s.options[i].text===a.owner){s.selectedIndex=i;break;}
  openMo('edit-action');
}

function saveEditAction(){
  var id=parseInt(document.getElementById('ea-id').value);
  var text=document.getElementById('ea-text').value.trim();
  var owner=document.getElementById('ea-owner').value;
  var due=document.getElementById('ea-due').value;
  var prio=document.getElementById('ea-prio').value||'Normal';
  if(!text||!owner||!due){toast('âš  Fill all fields');return;}
  var a=actions.find(function(x){return x.id===id;});
  if(!a) return;
  var old=a.text;
  a.text=text; a.owner=owner; a.due=due; a.priority=prio;
  log('<strong>'+owner+'</strong> edited action: "'+old.substring(0,25)+'â€¦" â†’ "'+text.substring(0,25)+'â€¦"','action');
  closeMo(); renderActions(); renderDash(); toast('âœ“ Action updated â€” Dashboard updated');
}

function openDelAction(id){
  var a=actions.find(function(x){return x.id===id;});
  if(!a) return;
  document.getElementById('da-id').value=id;
  document.getElementById('da-prev').innerHTML='Delete: <strong style="color:var(--text);">"'+a.text+'"</strong><br>Assigned to <strong style="color:var(--text);">'+a.owner+'</strong>';
  openMo('del-action');
}

function confirmDelAction(){
  var id=parseInt(document.getElementById('da-id').value);
  var a=actions.find(function(x){return x.id===id;});
  if(!a) return;
  log('<strong>Deleted</strong> action: "'+a.text.substring(0,40)+'" ('+a.owner+')','delete');
  actions=actions.filter(function(x){return x.id!==id;});
  closeMo(); renderActions(); renderDash(); toast('ğŸ—‘ Action deleted â€” Dashboard updated');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MEETINGS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderMeetings(){
  var el=document.getElementById('meetings-list');
  if(!meetings.length){el.innerHTML='<div class="empty"><span>ğŸ“…</span>No meetings yet. Add one below.</div>';return;}
  var today=new Date(); today.setHours(0,0,0,0);
  var sorted=[].concat(meetings).sort(function(a,b){return new Date(a.date)-new Date(b.date);});
  el.innerHTML=sorted.map(function(m){
    var d=new Date(m.date);
    var daysAway=Math.ceil((d-today)/86400000);
    var past=d<today;
    return '<div class="mi">'
      +'<div class="mi-top">'
      +'<div class="md" style="'+(past?'opacity:.45;':'')+'">'
      +'<div class="mdd">'+String(d.getDate()).padStart(2,'0')+'</div>'
      +'<div class="mmm">'+d.toLocaleString('en-GB',{month:'short'}).toUpperCase()+'</div></div>'
      +'<div class="mi-info">'
      +'<strong>'+m.title+'</strong>'
      +'<p>'+m.time+' Â· '+(m.location||'TBD')+(m.owner?' Â· '+m.owner:'')+'</p>'
      +'<p class="cdwn" style="color:'+(past?'var(--muted)':'var(--warning)')+';">'+(past?'Past':daysAway===0?'TODAY!':daysAway+'d away')+'</p>'
      +(m.notes?'<p style="font-size:.67rem;color:var(--muted);margin-top:3px;font-style:italic;">'+m.notes.substring(0,60)+(m.notes.length>60?'â€¦':'')+'</p>':'')
      +'</div>'
      +'<button class="rb" onclick="toggleReminder(this,\''+m.title.replace(/'/g,"\\'")+'\')" >ğŸ”” Set</button>'
      +'</div>'
      +'<div class="btn-row">'
      +'<div></div>'
      +'<button class="b-edit" onclick="openEditMeeting('+m.id+')">âœ Edit</button>'
      +'<button class="b-del" onclick="openDelMeeting('+m.id+')">ğŸ—‘ Del</button>'
      +'</div></div>';
  }).join('');
}

function addMeeting(){
  var title=document.getElementById('nm-title').value.trim();
  var date=document.getElementById('nm-date').value;
  var time=document.getElementById('nm-time').value;
  var loc=document.getElementById('nm-location').value.trim();
  var owner=document.getElementById('nm-owner').value;
  var notes=document.getElementById('nm-notes').value.trim();
  if(!title||!date||!time){toast('âš  Title, date & time are required');return;}
  meetings.push({id:Date.now(),title:title,date:date,time:time,location:loc,owner:owner,notes:notes});
  log('<strong>Meeting added</strong>: "'+title+'" on '+date+' at '+time+(owner?' â€” '+owner:''),'meeting');
  document.getElementById('nm-title').value=''; document.getElementById('nm-date').value='';
  document.getElementById('nm-time').value=''; document.getElementById('nm-location').value='';
  document.getElementById('nm-owner').value=''; document.getElementById('nm-notes').value='';
  renderMeetings(); renderDash(); toast('âœ“ Meeting added â€” now visible on Dashboard');
}

function openEditMeeting(id){
  var m=meetings.find(function(x){return x.id===id;});
  if(!m) return;
  document.getElementById('em-id').value=id;
  document.getElementById('em-title').value=m.title;
  document.getElementById('em-date').value=m.date;
  document.getElementById('em-time').value=m.time;
  document.getElementById('em-location').value=m.location||'';
  document.getElementById('em-notes').value=m.notes||'';
  var s=document.getElementById('em-owner');
  for(var i=0;i<s.options.length;i++) if(s.options[i].text===m.owner){s.selectedIndex=i;break;}
  openMo('edit-meeting');
}

function saveEditMeeting(){
  var id=parseInt(document.getElementById('em-id').value);
  var title=document.getElementById('em-title').value.trim();
  var date=document.getElementById('em-date').value;
  var time=document.getElementById('em-time').value;
  var loc=document.getElementById('em-location').value.trim();
  var owner=document.getElementById('em-owner').value;
  var notes=document.getElementById('em-notes').value.trim();
  if(!title||!date||!time){toast('âš  Title, date & time required');return;}
  var m=meetings.find(function(x){return x.id===id;});
  if(!m) return;
  var old=m.title;
  m.title=title; m.date=date; m.time=time; m.location=loc; m.owner=owner; m.notes=notes;
  log('<strong>Meeting edited</strong>: "'+old+'" â†’ "'+title+'" ('+date+')','meeting');
  closeMo(); renderMeetings(); renderDash(); toast('âœ“ Meeting updated â€” Dashboard updated');
}

function openDelMeeting(id){
  var m=meetings.find(function(x){return x.id===id;});
  if(!m) return;
  document.getElementById('dm-id').value=id;
  document.getElementById('dm-prev').innerHTML='Delete: <strong style="color:var(--text);">"'+m.title+'"</strong><br>'+m.date+' at '+m.time;
  openMo('del-meeting');
}

function confirmDelMeeting(){
  var id=parseInt(document.getElementById('dm-id').value);
  var m=meetings.find(function(x){return x.id===id;});
  if(!m) return;
  log('<strong>Deleted</strong> meeting: "'+m.title+'" ('+m.date+')','delete');
  meetings=meetings.filter(function(x){return x.id!==id;});
  closeMo(); renderMeetings(); renderDash(); toast('ğŸ—‘ Meeting deleted â€” Dashboard updated');
}

function toggleReminder(btn,name){
  var armed=btn.classList.toggle('armed');
  btn.textContent=armed?'âœ“ Armed':'ğŸ”” Set';
  if(armed){
    log('Reminder armed for: <strong>'+name+'</strong>','system');
    toast('ğŸ”” Reminder set for '+name);
    if(Notification.permission==='granted') new Notification('Reminder Armed',{body:'Before: '+name});
    else if(Notification.permission!=='denied') Notification.requestPermission();
  } else {
    toast('Reminder removed');
  }
  renderDash();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RESOLUTION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function saveResolution(){
  var text=document.getElementById('res-text').value.trim();
  var owner=document.getElementById('res-owner').value;
  if(!text){toast('âš  Please describe the resolution');return;}
  log('<strong>Resolution</strong> by '+(owner||'Director')+': "'+text.substring(0,80)+(text.length>80?'â€¦':'')+'"','resolution');
  document.getElementById('res-text').value=''; document.getElementById('res-owner').value='';
  closeMo(); renderAudit(); renderDash(); toast('âœ“ Resolution saved â€” visible on Dashboard & Audit');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MANUAL AUDIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function saveManualAudit(){
  var title=document.getElementById('ma-title').value.trim();
  var detail=document.getElementById('ma-detail').value.trim();
  var type=document.getElementById('ma-type').value;
  var owner=document.getElementById('ma-owner').value;
  if(!title){toast('âš  Entry title is required');return;}
  log('<strong>['+type.toUpperCase()+']</strong> '+title+(detail?': "'+detail.substring(0,80)+(detail.length>80?'â€¦':'')+'"':'')+' â€” '+(owner||'Director'),'manual');
  document.getElementById('ma-title').value=''; document.getElementById('ma-detail').value='';
  document.getElementById('ma-type').value='info'; document.getElementById('ma-owner').value='';
  closeMo(); renderAudit(); renderDash(); toast('âœ“ Audit entry saved â€” visible on Dashboard');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AUDIT RENDER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderAudit(){
  var el=document.getElementById('audit-list');
  if(!auditLog.length){el.innerHTML='<div class="empty"><span>ğŸ”</span>No audit entries yet.</div>';return;}
  el.innerHTML=auditLog.map(function(e){
    return '<div class="ae">'
      +'<div class="ldot" style="background:'+e.color+';"></div>'
      +'<div style="flex:1;min-width:0;">'
      +'<div class="ltxt">'+e.text+'</div>'
      +'<div class="ltime">'+e.time+' Â· '+e.date+'</div>'
      +'</div>'
      +'<button onclick="delAudit(\''+e.id+'\')" style="background:rgba(255,59,92,.07);border:1px solid rgba(255,59,92,.22);color:var(--urgent);border-radius:7px;padding:5px 9px;font-size:.68rem;font-weight:700;cursor:pointer;font-family:inherit;flex-shrink:0;margin-left:8px;align-self:center;">âœ•</button>'
      +'</div>';
  }).join('');
}

function delAudit(id){
  auditLog=auditLog.filter(function(e){return String(e.id)!==String(id);});
  renderAudit(); renderDash(); toast('Audit entry removed');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
compliance();
log('<strong>Portal</strong> session started Â· CNS Director Command','system');
renderDash();
</script>
</body>
</html>
